<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>阅读系统 - 古韵江湖AI</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .content-box {
            background: #fff;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .article-table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
        }

        .article-table th,
        .article-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .article-table th {
            background: #fafafa;
            font-weight: 500;
        }

        .platform-tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .platform-tag.wechat {
            background: #07c160;
            color: white;
        }

        .platform-tag.toutiao {
            background: #ff4d4f;
            color: white;
        }

        .action-btn {
            padding: 4px 8px;
            border: 1px solid #e8e8e8;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            margin-right: 5px;
        }

        .action-btn:hover {
            color: #1890ff;
            border-color: #1890ff;
        }

        .action-btn.liked {
            background: #1890ff;
            color: white;
            border-color: #1890ff;
        }

        .publish-form {
            margin-bottom: 30px;
            display: none;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .input-field {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .filter-buttons {
            margin: 20px 0;
        }

        .filter-btn {
            padding: 6px 12px;
            margin-right: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
        }

        .filter-btn.active {
            background: #1890ff;
            color: white;
            border-color: #1890ff;
        }

        #searchInput {
            width: 200px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <span class="year-2">2</span><span class="year-0">0</span><span class="year-2-2">2</span><span class="year-4">4</span>
                <span class="brand">古韵江湖</span><span class="ai">AI</span>
            </div>
            <ul>
                <li><a href="read.html" class="active">阅读</a></li>
                <li><a href="similarity.html">相似度对比</a></li>
                <li><a href="index.html">AI内容检测</a></li>
                <li><a href="thesis.html">论文AI检测</a></li>
                <li><a href="reduce.html">降AI</a></li>
                <li><a href="reduce2.html">降AI2.0</a></li>
                <li><a href="smart-edit.html">智改</a></li>
                <li><a href="pricing.html">价格</a></li>
                <li><a href="notice.html">公告</a></li>
                <li><a href="login.html" class="login-btn">登录</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <div class="content-box">
            <div id="publishSection" class="publish-form">
                <h2>发布文章</h2>
                <form id="publishForm">
                    <div class="form-group">
                        <input type="text" id="articleTitle" class="input-field" placeholder="文章标题" required>
                    </div>
                    <div class="form-group">
                        <textarea id="articleContent" class="input-field" placeholder="文章内容" required></textarea>
                    </div>
                    <div class="form-group">
                        <select id="platform" class="input-field" required>
                            <option value="toutiao">头条</option>
                            <option value="wechat">公众号</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">发布文章</button>
                </form>
            </div>

            <input type="text" id="searchInput" class="input-field" placeholder="搜索文章...">

            <div class="filter-buttons">
                <button class="filter-btn active" data-sort="time">最新发布</button>
                <button class="filter-btn" data-sort="hot">最多阅读</button>
                <button class="filter-btn" data-sort="likes">最多点赞</button>
            </div>

            <table class="article-table">
                <thead>
                    <tr>
                        <th>标题</th>
                        <th>平台</th>
                        <th>发布时间</th>
                        <th>阅读量</th>
                        <th>点赞数</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="articleList"></tbody>
            </table>
        </div>
    </div>

    <script>
        // 初始化示例文章数据
        const sampleArticles = [
            {
                id: 1,
                title: "人工智能发展趋势",
                content: "人工智能正在快速发展，影响着各个领域...",
                platform: "toutiao",
                author: "admin",
                readCount: 156,
                likes: ["user1", "user2"],
                publishTime: "2024-01-29T10:00:00Z"
            },
            {
                id: 2, 
                title: "5G技术应用前景",
                content: "5G技术的广泛应用将带来巨大变革...",
                platform: "wechat",
                author: "admin",
                readCount: 89,
                likes: ["user1"],
                publishTime: "2024-01-28T09:00:00Z"
            }
        ];

        // 文章数据库管理对象
        const ArticleDB = {
            KEY: 'articles_db',
            
            init() {
                if (!localStorage.getItem(this.KEY)) {
                    localStorage.setItem(this.KEY, JSON.stringify(sampleArticles));
                }
            },

            getAllArticles() {
                return JSON.parse(localStorage.getItem(this.KEY) || '[]');
            },

            addArticle(article) {
                const articles = this.getAllArticles();
                articles.push({
                    ...article,
                    id: Date.now(),
                    readCount: 0,
                    likes: [],
                    publishTime: new Date().toISOString()
                });
                localStorage.setItem(this.KEY, JSON.stringify(articles));
            },

            updateArticle(id, updates) {
                let articles = this.getAllArticles();
                const index = articles.findIndex(a => a.id.toString() === id.toString());
                if (index !== -1) {
                    articles[index] = { ...articles[index], ...updates };
                    localStorage.setItem(this.KEY, JSON.stringify(articles));
                }
            },

            deleteArticle(id) {
                let articles = this.getAllArticles();
                articles = articles.filter(a => a.id.toString() !== id.toString());
                localStorage.setItem(this.KEY, JSON.stringify(articles));
            }
        };

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            ArticleDB.init();
            loadArticles();

            const currentUser = localStorage.getItem('currentUser');
            const publishSection = document.getElementById('publishSection');
            
            if (currentUser) {
                publishSection.style.display = 'block';
                document.querySelector('.login-btn').textContent = currentUser;
            }

            // 绑定搜索事件
            document.getElementById('searchInput').addEventListener('input', () => loadArticles());

            // 绑定排序按钮事件
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    loadArticles(this.dataset.sort);
                });
            });

            // 绑定发布表单提交事件
            document.getElementById('publishForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (!currentUser) {
                    alert('请先登录');
                    window.location.href = 'login.html';
                    return;
                }

                const article = {
                    title: this.articleTitle.value,
                    content: this.articleContent.value,
                    platform: this.platform.value,
                    author: currentUser
                };

                ArticleDB.addArticle(article);
                this.reset();
                loadArticles();
                alert('发布成功！');
            });
        });

        function loadArticles(sortBy = 'time') {
            const articles = ArticleDB.getAllArticles();
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            let filteredArticles = articles;
            if (searchTerm) {
                filteredArticles = articles.filter(article => 
                    article.title.toLowerCase().includes(searchTerm) ||
                    article.content.toLowerCase().includes(searchTerm)
                );
            }

            // 排序
            filteredArticles.sort((a, b) => {
                switch(sortBy) {
                    case 'hot':
                        return (b.readCount || 0) - (a.readCount || 0);
                    case 'likes':
                        return (b.likes?.length || 0) - (a.likes?.length || 0);
                    default:
                        return new Date(b.publishTime) - new Date(a.publishTime);
                }
            });

            renderArticles(filteredArticles);
        }

        function renderArticles(articles) {
            const currentUser = localStorage.getItem('currentUser');
            const tbody = document.getElementById('articleList');
            
            tbody.innerHTML = articles.map(article => `
                <tr>
                    <td>${article.title}</td>
                    <td>
                        <span class="platform-tag ${article.platform}">
                            ${article.platform === 'wechat' ? '公众号' : '头条'}
                        </span>
                    </td>
                    <td>${new Date(article.publishTime).toLocaleDateString()}</td>
                    <td>${article.readCount || 0}</td>
                    <td>${article.likes?.length || 0}</td>
                    <td>
                        <button class="action-btn" onclick="viewArticle('${article.id}')">阅读</button>
                        <button class="action-btn" onclick="shareArticle('${article.id}')">分享</button>
                        ${currentUser ? `
                            <button class="action-btn ${article.likes?.includes(currentUser) ? 'liked' : ''}" 
                                onclick="toggleLike('${article.id}')">
                                ${article.likes?.includes(currentUser) ? '已点赞' : '点赞'}
                            </button>
                        ` : ''}
                        ${currentUser === article.author ? 
                            `<button class="action-btn" onclick="deleteArticle('${article.id}')">删除</button>` 
                            : ''}
                    </td>
                </tr>
            `).join('');
        }

        function viewArticle(id) {
            const article = ArticleDB.getAllArticles().find(a => a.id.toString() === id);
            if (article) {
                ArticleDB.updateArticle(id, { readCount: (article.readCount || 0) + 1 });
                alert(`${article.title}\n\n${article.content}`);
                loadArticles();
            }
        }

        function shareArticle(id) {
            const article = ArticleDB.getAllArticles().find(a => a.id.toString() === id);
            if (article) {
                const shareText = `${article.title}\n${article.content}`;
                if (navigator.share) {
                    navigator.share({ 
                        title: article.title,
                        text: shareText
                    });
                } else {
                    navigator.clipboard.writeText(shareText)
                        .then(() => alert('文章内容已复制到剪贴板'))
                        .catch(() => alert('复制失败，请手动复制'));
                }
            }
        }

        function toggleLike(id) {
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                alert('请先登录');
                return;
            }

            const article = ArticleDB.getAllArticles().find(a => a.id.toString() === id);
            if (article) {
                const likes = article.likes || [];
                const index = likes.indexOf(currentUser);
                
                if (index === -1) {
                    likes.push(currentUser);
                } else {
                    likes.splice(index, 1);
                }
                
                ArticleDB.updateArticle(id, { likes });
                loadArticles();
            }
        }

        function deleteArticle(id) {
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                alert('请先登录');
                return;
            }

            if (confirm('确定要删除这篇文章吗？')) {
                ArticleDB.deleteArticle(id);
                loadArticles();
            }
        }
    </script>
</body>
</html>
